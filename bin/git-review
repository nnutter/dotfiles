#!/usr/bin/env bash

main() {
  # shellcheck disable=1090
  source "$(git --exec-path)/git-sh-setup"

  local upstream="@{upstream}" head="HEAD"
  declare -a other_options
  while [ $# -gt 0 ]; do
    OPT="$1"
    shift
    case $OPT in
    --) break ;;
    --head)
      head="$1"
      shift
      ;;
    -p) other_options+=("-p") ;;
    --stat) other_options+=("--stat") ;;
    -u)
      upstream="$1"
      shift
      ;;
    -w) other_options+=("-w") ;;
    esac
  done

  git log --reverse "${other_options[@]}" "$upstream".."$head" -- "$@"
}

# shellcheck disable=SC2034
# SUBDIRECTORY_OK is used by `git-sh-setup`.
SUBDIRECTORY_OK=1

# shellcheck disable=SC2034
# OPTIONS_SPEC is used by `git-sh-setup`.
OPTIONS_SPEC="\
git review [options]
--
h                   Show this help/usage
head=               Head branch if not current branch
p,patch             Show patch
u,upstream=         Upstream branch to use if not branch's literal upstream
w,ignore-all-space  Show patch
stat                Generate diff stats
"

main "$@"
