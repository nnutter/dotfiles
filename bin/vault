#!/usr/bin/env bash

set -o errexit -o nounset -o pipefail


if test "$(perl -e 'print int ((-M $ARGV[0]) * 24)' -- ~/.vault-token)" -ge 4
then
    /usr/local/bin/vault login -method=userpass -path=ping username="$USER" password=$(security find-generic-password -l vault -a "$USER" -w) >/dev/null
fi
/usr/local/bin/vault "$@"
